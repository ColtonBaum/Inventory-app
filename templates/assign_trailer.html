{% extends "base.html" %}
{% block title %}Assign Trailer{% endblock %}

{% block head_extra %}
<style>
  .wrap { background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:16px; }
  .wrap h2 { margin:0 0 12px; color:#111827; }
  .grid { display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:16px; }
  @media (max-width:820px){ .grid { grid-template-columns:1fr; } }
  .field { display:flex; flex-direction:column; gap:6px; }
  .field label { font-size:13px; color:#374151; }
  .input, select { padding:10px 12px; border:1px solid #d1d5db; border-radius:8px; font-size:14px; }
  .btn { appearance:none; border:none; border-radius:8px; padding:10px 14px; background:#2563eb; color:#fff; cursor:pointer; }
  .btn:hover { background:#1d4ed8; }
  .btn.muted { background:#6b7280; }
  .btn.ghost { background:#fff; color:#111827; border:1px solid #d1d5db; }
  .hint { color:#6b7280; font-size:12px; }

  /* Extra tooling rows */
  #extra-tooling { margin-top:10px; }
  #extra-rows .extra-row{
    display:grid;
    grid-template-columns: 1fr 1fr 120px 1fr auto;
    gap:8px;
    margin-bottom:8px;
    align-items:center;
  }
</style>
{% endblock %}

{% block content %}
<div class="wrap">
  <h2>Assign Trailer</h2>
  <form method="POST" action="">
    <div class="grid">
      <div class="field">
        <label>Trailer ID *</label>
        <input class="input" type="text" name="trailer_id" placeholder="e.g., T-1001" required>
        <div class="hint">External trailer identifier used in the field.</div>
      </div>

      <div class="field">
        <label>Job Name *</label>
        <input class="input" type="text" name="job_name" required>
      </div>

      <div class="field">
        <label>Job Number *</label>
        <input class="input" type="text" name="job_number" required>
      </div>

      <input type="hidden" name="location" value="">

      <div class="field">
        <label>Tooling List *</label>
        <!-- IMPORTANT: name must match backend -> tooling_list_name -->
        <select name="tooling_list_name" class="input" required id="tooling_list_name">
          <option value="" disabled selected>Select a list</option>
          <option value="Standard Trailer">Standard Trailer</option>
          <option value="Gang Box">Gang Box</option>
          <option value="Semi Trailer">Semi Trailer</option>
          <option value="Utility Trailer">Utility Trailer</option>
        </select>
      </div>

      <div class="field">
  <label for="ln_25s">LN-25</label>
  <input
    class="input"
    id="ln_25s"
    type="text"
    name="ln_25s"
    placeholder="Serial Numbers"
    oninput="this.form.querySelector('input[name=&quot;lN-25s&quot;]').value = this.value"
  >
  <!-- Back-compat alias: keeps older name populated automatically -->
  <input type="hidden" name="lN-25s" value="">
</div>
</div>


    <!-- Extra Tooling (credit-back) -->
    <hr style="margin:16px 0">
    <label style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
      <input type="checkbox" name="enable_credit_back" value="1">
      Add Extra Tooling (credit-back)
    </label>

    <div id="extra-tooling" style="display:none;">
      <div id="extra-rows"></div>
      <button type="button" id="add-extra" class="btn" style="margin-top:8px;">+ Add Item</button>
      <p class="hint" style="margin-top:6px;">
        Saved as <code>item_name</code> / <code>item_number</code> / <code>quantity</code> / <code>category</code>.
      </p>
    </div>

    <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap;">
      <button class="btn" type="submit">Assign Trailer</button>
      <a class="btn muted" href="{{ url_for('inventory.dashboard') }}">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
  (function () {
    const cb = document.querySelector('input[name="enable_credit_back"]');
    const wrap = document.getElementById('extra-tooling');
    const rows = document.getElementById('extra-rows');
    const addBtn = document.getElementById('add-extra');

    function toggleExtra() {
      wrap.style.display = cb && cb.checked ? 'block' : 'none';
    }

    function makeRow() {
      const div = document.createElement('div');
      div.className = 'extra-row';
      div.innerHTML = `
        <input class="input" name="extra_tooling_items[item_name][]"   placeholder="Item name">
        <input class="input" name="extra_tooling_items[item_number][]" placeholder="Item #">
        <input class="input" name="extra_tooling_items[quantity][]"   type="number" min="0" value="1">
        <input class="input" name="extra_tooling_items[category][]"   placeholder="Category (optional)">
        <button type="button" class="btn ghost remove">Remove</button>
      `;
      div.querySelector('.remove').addEventListener('click', () => div.remove());
      return div;
    }

    if (cb) {
      cb.addEventListener('change', toggleExtra);
      toggleExtra();
    }
    if (addBtn) {
      addBtn.addEventListener('click', () => rows.appendChild(makeRow()));
    }
  })();
</script>
{% endblock %}
